<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <script src="../../build/3Dmol.js"></script>
    <style>
      table td { text-align: center; }
      table th {padding-top: 1em;}
    </style>
  </head>

  <body>
    <script>

      $(document).ready(function() {

          //install a right-click handler on every canvas to export png
          $('canvas').bind('contextmenu',function(e) {
              var dt = e.currentTarget.toDataURL('image/png');
              window.location = dt;
          });
      });
        </script>

    <table width="100%">
      <tr>
        <td colspan=2 height=200px>
          51  <code> prmtop and mdcrd implementation</code>
        </td>
      </tr>
      <tr>
        <td width="50%"><div id="test51" style="width: 400px; height: 400px; position: relative;"></div>
      </td>
     <script>
    var viewer = $3Dmol.createViewer($("#test51"), {
		defaultcolors : $3Dmol.rasmolElementColors
		});
    viewer.setBackgroundColor(0xffffffff);
    var m;
    var fr = [[]];
    var current = 0;
    var rawFile = new XMLHttpRequest();
    rawFile.open("GET", "volData/TC5b.prmtop", false);
    rawFile.onreadystatechange = function (){
        if(rawFile.readyState === 4){
            if(rawFile.status === 200 || rawFile.status == 0){
                var data = rawFile.responseText;
		m = viewer.addModel(data, "prmtop");	
                var File = new XMLHttpRequest();
   		File.open("GET", "volData/heat1.mdcrd", false);
    		File.onreadystatechange = function(){
		    if(File.readyState === 4){
	    		if(File.status === 200 || File.status == 0){
			    var coordinatesData = File.responseText;
			    fr = m.setCoordinates(coordinatesData, "mdcrd");
			    console.log(fr);
			    viewer.setStyle({},{sphere:{}});
			    current = 0;
			    var display = function(){
				var atoms = m.selectedAtoms({});
				var index = 0;
				for (atom in atoms){
				    atom.x = fr[current][index].x;
				    atom.y = fr[current][index].y;
				    atom.z = fr[current][index].z;
				    index++;
				}
				current++;
				if (current == 200)
				    current = 0;
				viewer.zoomTo();
				viewer.render();
			    }
			    setInterval(display, 3000);
			}
		    }
		}
		File.send(null);
	    }	
        }
    }
    rawFile.send(null);    

    </script>
        <td width="50%"><img src="imgs/test51.png"></td>
      </tr>
    </table>

  </body>
</html>
